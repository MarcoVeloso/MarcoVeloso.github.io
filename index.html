<!DOCTYPE html>
<html> 

<style>
  #clipboard_area {
    float: left;
  }

  textarea {
    padding: 10px;
    line-height: 1.5;
    border-radius: 5px;
    border: 1px solid #ccc;
    box-shadow: 1px 1px 1px #999;
    margin-bottom: 10px;
  }

  div {
    text-align: center;
  }

  label {     
    display: block;   
    margin-bottom: 10px;
  } 
  
  p {
    font-weight: bold;
  }
   
</style>

<script src="jquery.min.js"></script>    
<script>

  var qr_timeout = null;

  $(document).ready(function() {

    getData();

    $(window).focus(function() {      
      getData();      
    });

  });  

  function save() {
    let now = new Date(Date.now()).toLocaleString('pt-BR');

    $("#status").text("Saving...");
    update();
    $("#status").text("Saved at " + now);
  }

  function getData() {
    $('#refresh').show();
    $('#clipboard_area').hide();    

    let settings = {
      "async": true,
      "crossDomain": true,
      "url": "https://clipboard-dc71.restdb.io/rest/clip/5f74d023d279373c003b725a",
      "method": "GET",
      "headers": {
        "content-type": "application/json",
        "x-apikey": "5f74d0f62b02c84b29bf85c3",
        "cache-control": "no-cache"
      }
    } 
                  
    $.ajax(settings).done(function (response) {
      let texto = response.clip_area;

      $("#links").empty();

      if(texto) {
        links = texto.match(/([\w+]+\:\/\/)?([\w\d-]+\.)*[\w-]+[\.\:]\w+([\/\?\=\&\#.]?[\w-]+)*\/?/gm);        

        links.forEach((link, index) => {          
          $("#links").append('<p><a target="_blank" href="' + link + '">Link ' + (index+1) + '</a>');
        });  

        texto = texto + '\n';
      }                  
        
      $('#clipboard_area').show();
      $('#refresh').hide();
      $("#clipboard").val(texto);
    });        
  }

  function update() {
    let texto = $("#clipboard").val();
    let jsondata = {"clip_area": texto};
    let settings = {
      "async": true,
      "crossDomain": true,
      "url": "https://clipboard-dc71.restdb.io/rest/clip/5f74d023d279373c003b725a",
      "method": "PUT",
      "headers": {
        "content-type": "application/json",
        "x-apikey": "5f74d0f62b02c84b29bf85c3",
        "cache-control": "no-cache"
      },
      "processData": false,
      "data": JSON.stringify(jsondata)
    }
    
    $.ajax(settings).done(function (response) {
      console.log('Ok!');
    });
  }
</script>

<body>
  <label for="clipboard">PowerClip by MF (Marcommand) 1.1</label>  
  
  <div id="clipboard_area">
    <textarea id="clipboard" name="clipboard" rows="15" cols="80"></textarea> 
    <p>
      <input id="save_button" type="button" value="Save" onclick="save()">  
      <p id="status"></p>
    </p>     
  </div>  

  <div id="links"></div>

  <p id="refresh">Loading data...</p>
  
</body>
</html>
