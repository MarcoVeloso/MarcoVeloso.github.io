<style>
* {
  box-sizing: border-box;
}

div {
  display: flex;
  margin: 5px;
}

ol {
  list-style-type: none;
  width: 300px;
}

button {
  height: 50px;
  margin: 5px;
}

.greyscale {
  filter: grayscale(100%);
}
</style>

<div>CustomVision by MF 0.6.1 - Camera - CV model local - Logic control</div>
<div>
  <div id="webcam-container"></div>
  <h3><ol id="prediction-list"></ol></h3>
</div>
<div>
  <button type="button" onclick="photo()">Foto em Cores</button>
  <button type="button" onclick="photo(true)">Foto em Preto e Branco</button>
</div>
<canvas id="photo-canvas"></canvas> 

<script src="lib/tf.min.js"></script>
<script src="lib/jquery-3.3.1.slim.min.js"></script>
<script src="lib/teachablemachine-image.min.js"></script>
<script src="js/predict.js"></script > 

<script type="text/javascript">
  let webcam, model, list;
  let width=640, height=360;

  $( document ).ready(async function () {
    await load_model();
 
    webcam = new tmImage.Webcam(width, height, false); 
    await webcam.setup({ facingMode: "environment" });
    await webcam.play();
    window.requestAnimationFrame(loop);

    document.getElementById("webcam-container").appendChild(webcam.canvas);
    list = $("#prediction-list");
  });

  async function loop() {
    webcam.update();
    await predict_local(model, webcam.canvas);
    window.requestAnimationFrame(loop);
  }
	
  async function photo(greyscale=false) {
    canvas = document.getElementById("photo-canvas");
    canvas.width = width;
    canvas.height = height;

    if (greyscale)
      canvas.classList.add("greyscale");
    else
      canvas.classList.remove("greyscale");  

    list.empty();

    context = canvas.getContext('2d');
    context.drawImage(webcam.canvas, 0, 0, canvas.width, canvas.height);
    //await predict_online(canvas);
    await predict_local(model, webcam.canvas);
  }

</script>